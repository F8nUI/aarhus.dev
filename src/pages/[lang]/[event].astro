---
import Layout from '@layouts/Layout.astro'
import EventHeader from '@components/EventHeader'
import { getEntry } from 'astro:content'
import { render } from 'astro:content'
import { getCollection } from 'astro:content'
import { parseEvent } from '@lib/event'

export async function getStaticPaths() {
  const events = await getCollection('events')
  const paths = events.map((event) => {
    const [lang, eventId] = event.id.split('/')
    return {
      params: { lang, event: eventId },
      props: { language: lang, event: parseEvent(event) },
    }
  })

  return paths
}

const { event: eventAsync, language } = Astro.props
const event = await eventAsync
const { Content } = await render(event)
const { organizer: organizerRef } = event.data
const metadata = {
  title: event.data.title,
  description: event.data.subtitle || `${event.data.title} - ${event.data.venue.title}, ${new Date(event.data.date).toLocaleDateString('en-US', { month: 'long', day: 'numeric', year: 'numeric' })}`
}
---

<Layout {language} {metadata}>
  <EventHeader event={event} isEventPage languageBadge={false} />
  <div class="h-px my-4 w-full bg-gray-100"></div>
  <div class="markdown">
    <Content />
  </div>
</Layout>
